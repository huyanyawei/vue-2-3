import t from"vue";import{shallowReactive as e,createApp as n,h as r}from"vue3";var i=Symbol();function o(t,e){t[i]||(t[i]=e,Object.defineProperty(t,"parentNode",{get:function(){return this[i]||this.parentElement}}))}var s=function(t,e){var n=t.splice(0);e.append.apply(e,n),n.forEach((function(t){t[i]=void 0}))};function a(t,e){if(this.frag){var n=this.frag.indexOf(e);n>-1&&this.frag.splice(n,0,t)}if(this[c]){var r=this[c].get(e);r&&(e=r[0])}e.before(t),o(t,this)}function u(t){if(this.frag){var e=this.frag.indexOf(t);e>-1&&this.frag.splice(e,1)}var n=this[c];if(n){var r=n.get(t);if(r)return s(r,t),n.delete(t),void(t[i]=void 0)}t.remove()}var c=Symbol(),f={insertBefore:a,removeChild:u},v=Symbol(),p={insertBefore:a,before:function(t){this.frag[0].before(t)},remove:function(){var t=this[v],e=this.frag,n=e.splice(0,e.length,t);n[0].before(this[v]),n.forEach((function(t){return t.remove()}))},removeChild:u,appendChild:function(t){var e=this.frag.length;this.frag[e-1].after(t);var n=this[v];this.frag[0]===n&&(this.frag.splice(0,1),n.remove()),o(t,this),this.frag.push(t)}},d={inserted:function(t){var e=Array.from(t.childNodes),n=t.parentNode,r=document.createComment("");t[v]=r,0===e.length&&e.push(r);var i=document.createDocumentFragment();i.append.apply(i,e),t.replaceWith(i),t.frag=e,function(t,e,n){t[c]||(t[c]=new Map,Object.assign(t,f)),t[c].set(e,n)}(n,t,e),o(t,n),e.forEach((function(e){return o(e,t)})),Object.defineProperty(t,"innerHTML",{set:function(e){var n=document.createElement("div");n.innerHTML=e;var r=t.frag.length;Array.from(n.childNodes).forEach((function(e){return t.appendChild(e)})),n.append.apply(n,t.frag.splice(0,r))},get:function(){return""}}),Object.assign(t,p)},unbind:function(t){s(t.frag,t),t[v].remove()}},h=function(){};function l(t){return{insertBefore:function(e,n){return t.parentNode.insertBefore(e,n||t)},removeAttribute:h,setAttribute:h}}var m=Symbol("vue-2-3"),g=/-(\w)/g;var b={props:["parent","vnode"],created:function(){this.state=t.observable({vnode:null})},mounted:function(){var e=this,n=this;this.vue2App=new t({beforeCreate:function(){this.$parent=n.parent},directives:{frag:d},render:function(t){return t("div",{directives:[{name:"frag"}]},[e.state.vnode()])}}),this.vue2App.$mount(this.$el)},beforeUnmount:function(){this.vue2App.$destroy()},render:function(){return this.state.vnode=this.vnode,r("div")}};function y(t){var e={},n=function(n){e[n]=function(){return r(b,{parent:t,vnode:t.$scopedSlots[n]})}};for(var i in t.$scopedSlots)n(i);return e}function $(t,e){for(var n=t;n;){if(n._provided&&n._provided[e])return n._provided[e];n=n.$parent}}var O={inheritAttrs:!1,created:function(){this[m]=e({attrs:null,slots:null})},provide:function(){return{}},mounted:function(){var t=this,e=this;this.v3app=n({render:function(){return r(t.$options.component,t[m].attrs,t[m].slots)},mounted:function(){e.v3=this._.subTree.component.proxy}}),this.v3app._context.provides=new Proxy({},{has:function(e,n){return $(t,n)},get:function(e,n){return $(t,n)},set:function(e,n,r){return t._provided[n]=r,!0}});var i=this.$el,o=this.v3app.mount(l(i));this.$el=o.$el,i.remove()},beforeDestroy:function(){this.v3app.unmount()},render:function(t){return this[m].attrs=function(t){var e,n=t.$attrs,r=t.$listeners,i=t.$vnode.data,o=Object.assign({},n);for(var s in(i.class||i.staticClass)&&(o.class=[i.class,i.staticClass]),(i.style||i.staticStyle)&&(o.style=[i.style,i.staticStyle]),r)o[(e=s,"&"===e[0]&&(e=e.slice(1)+"Passive"),"~"===e[0]&&(e=e.slice(1)+"Once"),"!"===e[0]&&(e=e.slice(1)+"Capture"),"on"+(e[0].toUpperCase()+e.slice(1).replace(g,(function(t,e){return e?e.toUpperCase():""}))))]=r[s];return o}(this),this[m].slots=y(this),t("div")}},_=function(t){var e=Object.create(O);return e.component=t,e};function A(){return(A=Object.assign||function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var r in n)Object.prototype.hasOwnProperty.call(n,r)&&(t[r]=n[r])}return t}).apply(this,arguments)}var C=/\B([A-Z])/g,j=/^on[A-Z]/,x=/(Once|Passive|Capture)$/,P={Once:"~",Passive:"&",Capture:"!"};var w={props:["parent","vnode"],created:function(){this.state=e({vnode:null})},mounted:function(){var t=this;this.vue3App=n({render:function(){return t.state.vnode()}}),this.vue3App._context.provides=this.parent._.provides;var e=this.$el;this.vue3App.mount(l(e)),e.remove()},destroyed:function(){this.vue3App.unmount()},render:function(t){return this.state.vnode=this.vnode,t("div")}};function S(t,e){var n={},r=function(r){n[r]=function(){return t(w,{attrs:{parent:e,vnode:e.$slots[r]}})}};for(var i in e.$slots)r(i);return n}var E={configurable:!0},N={created:function(){this._[m]=t.observable({data:null,slots:null})},mounted:function(){var e=this,n=this,r=this.$el;this.v2=new t({provide:function(){return new Proxy(e._.parent.provides,{getOwnPropertyDescriptor:function(t,e){if(e in t)return E}})},render:function(t){return t(e.$options.component,A({},e._[m].data,{scopedSlots:S(t,e)}))},mounted:function(){for(var t,e,i=n._,o=i.vnode.el;i.vnode.el===o;)i.vnode.el=this.$el,i.parent&&(i=i.parent);t=r,e=this.$el.parentNode,Object.defineProperty(t,"parentNode",{get:function(){return this.parentElement||e}})},destroyed:function(){this.$el.replaceWith(r)},methods:{exposeProvided:function(t){return Object.assign(e._.provides,t)}},el:r})},beforeUnmount:function(){this.v2.$destroy()},render:function(){var t=function(t){var e={style:void 0,class:void 0,on:{},attrs:{}},n=e.on,r=e.attrs;for(var i in t)if(j.test(i)){var o=i.slice(2);if(x.test(o)){for(var s=void 0;s=o.match(x);)o=P[s[0]]+o.slice(0,-s[0].length);o=o.replace("!~","~!")}n[o=o.replace(C,"-$1").toLowerCase()]=t[i]}else"class"===i||"style"===i?e[i]=t[i]:r[i]=t[i];return e}(this.$attrs);return this._[m].data=t,this._[m].slots=this.$slots,r("div")}},B={created:function(){this.$root.exposeProvided(this._provided)}},U=function(t){var e=Object.create(t);e.mixins=[B].concat(t.mixins||[]);var n=Object.create(N);return n.component=e,n};export{_ as toVue2,U as toVue3};
